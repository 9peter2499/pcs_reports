<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    
    <!-- Custom Dashboard CSS -->
    <style>
        .stat-card-title { font-size: 0.9rem; font-weight: 500; opacity: 0.9; }
        .stat-card-value { font-size: 1.8rem; font-weight: 600; }
        .card-icon-bg { position: absolute; right: 10px; top: 10px; font-size: 3rem; opacity: 0.15; transform: rotate(-15deg); }
        
        /* Zone Colors */
        .bg-scope { background-color: #2c7be5; color: white; }
        
        .severity-box { border-radius: 8px; padding: 10px; text-align: center; height: 100%; }
        .sev-critical { background-color: #e63757; color: white; border: 1px solid #b51a36; }
        .sev-major { background-color: #fd7e14; color: white; border: 1px solid #d66408; }
        .sev-minor { background-color: #ffc107; color: #333; border: 1px solid #d39e00; }
        .sev-trivial { background-color: #6c757d; color: white; border: 1px solid #495057; }

        .fix-type-card { border-left: 5px solid; transition: transform 0.2s; }
        .fix-type-card:hover { transform: translateY(-3px); }
        .fix-redev { border-color: #0dcaf0; background-color: #f0fdff; }
        .fix-cr { border-color: #0d6efd; background-color: #f0f7ff; }
        .fix-ui { border-color: #6610f2; background-color: #f5f0ff; }
        .fix-flow { border-color: #d63384; background-color: #fff0f6; }
    </style>

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="app-container">
        <!-- Layout Placeholders -->
        <header id="header-placeholder" class="app-header fixed-top"></header>
        <nav id="sidebar-placeholder" class="bg-white sidebar-hidden"></nav>

        <!-- Main Content -->
        <main id="main-content" class="main-content-expanded">
            <div class="container-fluid pt-4 px-4 content-wrapper">
                
                <!-- Title & Filters -->
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                    <div>
                        <h2 class="fw-bold mb-0">Project Dashboard</h2>
                        <p class="text-muted small mb-0">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                    
                    <!-- Filters Container -->
                    <div id="admin-filter-container" class="d-none d-flex flex-row align-items-center gap-2 flex-wrap">
                        
                        <!-- ‚ú® 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Module Filter (‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏î‡∏á) -->
                        <select id="dashboard-module-filter" class="form-select shadow-sm border-primary w-auto" style="min-width: 200px;">
                            <option value="all">üì¶ ‡∏ó‡∏∏‡∏Å Module</option>
                        </select>

                        <!-- 2. Test Phase Filter -->
                        <select id="dashboard-phase-filter" class="form-select shadow-sm border-primary w-auto" style="min-width: 180px;">
                            <option value="all">üìå ‡∏ó‡∏∏‡∏Å Phase</option>
                        </select>
                        
                        <!-- 3. Company Filter -->
                        <select id="dashboard-company-filter" class="form-select shadow-sm border-primary w-auto" style="min-width: 250px;">
                            <option value="all">üè¢ ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                        </select>
                    </div>
                </div>

                <!-- SECTION 1: SCOPE OVERVIEW (BLUE ZONE) -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="card bg-scope shadow-sm border-0 h-100 overflow-hidden">
                            <div class="card-body position-relative">
                                <div class="stat-card-title">Total TORs</div>
                                <div class="stat-card-value" id="stat-tor">-</div>
                                <i class="bi bi-file-earmark-text card-icon-bg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-scope shadow-sm border-0 h-100 overflow-hidden">
                            <div class="card-body position-relative">
                                <div class="stat-card-title">Modules</div>
                                <div class="stat-card-value" id="stat-module">-</div>
                                <i class="bi bi-grid card-icon-bg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-scope shadow-sm border-0 h-100 overflow-hidden">
                            <div class="card-body position-relative">
                                <div class="stat-card-title">Test Objectives</div>
                                <div class="stat-card-value" id="stat-objective">-</div>
                                <i class="bi bi-crosshair card-icon-bg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-scope shadow-sm border-0 h-100 overflow-hidden">
                            <div class="card-body position-relative">
                                <div class="stat-card-title">Test Scenarios</div>
                                <div class="stat-card-value" id="stat-scenario">-</div>
                                <i class="bi bi-list-check card-icon-bg"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 2: TEST EXECUTION & SEVERITY -->
                <div class="row g-4 mb-4">
                    <!-- Execution Stats -->
                    <div class="col-lg-8">
                        <div class="card shadow-sm border-0 h-100">
                            <div class="card-header bg-white py-3 border-bottom"><h6 class="mb-0 fw-bold text-dark"><i class="bi bi-activity me-2"></i>Execution Status</h6></div>
                            <div class="card-body">
                                <div class="row g-2 text-center mb-4">
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 bg-light rounded-3 border h-100">
                                            <div class="text-muted small">Assigned</div>
                                            <div class="h3 fw-bold mb-0 text-primary" id="exec-assigned">-</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 bg-light rounded-3 border h-100">
                                            <div class="text-muted small">Executed</div>
                                            <div class="h3 fw-bold mb-0 text-dark" id="exec-executed">-</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 rounded-3 border bg-success-subtle border-success h-100">
                                            <div class="text-success small fw-bold">PASSED</div>
                                            <div class="h3 fw-bold mb-0 text-success" id="exec-passed">-</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 rounded-3 border bg-danger-subtle border-danger h-100">
                                            <div class="text-danger small fw-bold">FAILED</div>
                                            <div class="h3 fw-bold mb-0 text-danger" id="exec-failed">-</div>
                                        </div>
                                    </div>
                                    <!-- ‚ú® 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Not Run (‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡∏≥) -->
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 rounded-3 border bg-secondary-subtle border-secondary h-100">
                                            <div class="text-secondary small fw-bold">NOT RUN</div>
                                            <div class="h3 fw-bold mb-0 text-secondary" id="exec-notrun">-</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4 col-xl-2">
                                        <div class="p-3 bg-light rounded-3 border h-100">
                                            <div class="text-muted small">Remaining</div>
                                            <div class="h3 fw-bold mb-0 text-dark opacity-50" id="exec-remaining">-</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Progress Bar -->
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between small mb-1">
                                        <span>Overall Progress</span>
                                        <span class="fw-bold" id="progress-percent">0%</span>
                                    </div>
                                    <div class="progress" style="height: 12px;">
                                        <div class="progress-bar bg-success" id="prog-bar-pass" role="progressbar" style="width: 0%"></div>
                                        <div class="progress-bar bg-danger" id="prog-bar-fail" role="progressbar" style="width: 0%"></div>
                                        <!-- Not Run ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ -->
                                        <div class="progress-bar bg-secondary" id="prog-bar-notrun" role="progressbar" style="width: 0%"></div>
                                        <!-- Remaining ‡∏à‡∏≤‡∏á‡πÜ -->
                                        <div class="progress-bar bg-light border" id="prog-bar-remain" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Severity Breakdown -->
                    <div class="col-lg-4">
                        <div class="card shadow-sm border-0 h-100">
                            <div class="card-header bg-white py-3 border-bottom"><h6 class="mb-0 fw-bold text-dark"><i class="bi bi-bug me-2"></i>Defect Severity</h6></div>
                            <div class="card-body">
                                <div class="row g-2 h-100">
                                    <div class="col-6">
                                        <div class="severity-box sev-critical">
                                            <div class="small text-uppercase opacity-75">Critical</div>
                                            <div class="h2 mb-0 fw-bold" id="sev-critical">0</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="severity-box sev-major">
                                            <div class="small text-uppercase opacity-75">Major</div>
                                            <div class="h2 mb-0 fw-bold" id="sev-major">0</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="severity-box sev-minor">
                                            <div class="small text-uppercase opacity-75">Minor</div>
                                            <div class="h2 mb-0 fw-bold" id="sev-minor">0</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="severity-box sev-trivial">
                                            <div class="small text-uppercase opacity-75">Trivial</div>
                                            <div class="h2 mb-0 fw-bold" id="sev-trivial">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 3: FIX ANALYSIS -->
                <h6 class="fw-bold text-muted mb-3 text-uppercase" style="font-size: 0.85rem; letter-spacing: 1px;">Defect Analysis & Fix Types</h6>
                <div class="row g-3 mb-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="card shadow-sm h-100 fix-type-card fix-redev">
                            <div class="card-body">
                                <h6 class="fw-bold text-info-emphasis">Re-Development</h6>
                                <p class="small text-muted mb-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°/‡∏ö‡∏±‡πä‡∏Å</p>
                                <h3 class="fw-bold mb-0 text-end" id="fix-redev">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card shadow-sm h-100 fix-type-card fix-cr">
                            <div class="card-body">
                                <h6 class="fw-bold text-primary-emphasis">Change Request</h6>
                                <p class="small text-muted mb-2">Requirement ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
                                <h3 class="fw-bold mb-0 text-end" id="fix-cr">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card shadow-sm h-100 fix-type-card fix-ui">
                            <div class="card-body">
                                <h6 class="fw-bold text-black">Change UI/UX</h6>
                                <p class="small text-muted mb-2">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠/Cosmetic</p>
                                <h3 class="fw-bold mb-0 text-end" id="fix-ui">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card shadow-sm h-100 fix-type-card fix-flow">
                            <div class="card-body">
                                <h6 class="fw-bold text-danger-emphasis">Change Workflow</h6>
                                <p class="small text-muted mb-2">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
                                <h3 class="fw-bold mb-0 text-end" id="fix-flow">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 4: FAIL LIST TABLE -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold text-danger"><i class="bi bi-exclamation-octagon-fill me-2"></i>Outstanding Failed Items (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô)</h6>
                        <a href="/tcwrpt.html" class="btn btn-sm btn-outline-secondary">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>No.</th>
                                        <th>Test Objective</th>
                                        <th>Module</th>
                                        <th>Test Date</th>
                                        <th class="text-center text-danger">Days Active</th>
                                        <th class="text-center">Severity</th>
                                        <th>Fix Type</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="failed-issues-tbody">
                                    <tr><td colspan="8" class="text-center p-4 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/layout-loader.js"></script>
    <script src="/js/index.js"></script>
    <script src="/js/dashboard.js"></script>

</body>
</html>