<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Case Report - PCS Test Case</title>

    <!-- CSS Links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">

</head>
<body>
    <div class="app-container">

        <!-- Header Placeholder -->
        <header id="header-placeholder" class="app-header fixed-top"></header>
        <!-- Sidebar Placeholder -->
        <nav id="sidebar-placeholder" class="bg-white sidebar-hidden"></nav>

        <!-- ===== MAIN CONTENT AREA ===== -->
        <main id="main-content" class="main-content-expanded">
            <div class="container-fluid pt-4 px-4 content-wrapper">

                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>Test Case ราย Modules</h1>
                </div>

                <!-- Search Tools Card (Updated Layout) -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card mb-4 shadow-sm border-0">
    <div class="card-body bg-light rounded">
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">Module</label>
                <select id="report-module-filter" class="form-select border-0 shadow-sm">
                    <option value="all">Loading...</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">Sub-Module</label>
                <select id="report-submodule-filter" class="form-select border-0 shadow-sm" disabled>
                    <option value="all">แสดงทุก Sub Module</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">Phase</label>
                <select id="report-phase-filter" class="form-select border-0 shadow-sm"></select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">Status</label>
                <select id="report-status-filter" class="form-select border-0 shadow-sm">
                    <option value="all">All Status</option>
                    <option value="passed">Passed</option>
                    <option value="failed">Failed</option>
                    <option value="blocked">Blocked</option>
                    <option value="pending">Pending</option>
                </select>
            </div>
        </div>
    </div>
</div>

<div class="table-responsive shadow-sm rounded bg-white p-0">
    <table class="table table-bordered table-hover align-middle mb-0" id="report-table-container">
        <thead class="bg-light">
            <tr class="text-center align-middle text-secondary small text-uppercase">
                <th style="width: 15%; background-color: #f8f9fa;">Main Module</th>
                <th style="width: 15%; background-color: #f8f9fa;">Sub Module</th>
                <th style="width: 30%; background-color: #f8f9fa;">Test Objective</th>
                <th style="width: 30%; background-color: #f8f9fa;">Test Name (Scenario)</th>
                <th style="width: 10%; background-color: #f8f9fa;">Result</th>
            </tr>
        </thead>
        <tbody class="small">
            </tbody>
    </table>
</div>

            </div>
            <!-- Footer -->
            <footer class="app-footer">
                 <div class="container-fluid">
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">© 2025 PCS Test Case System</span>
                        <span class="text-muted">Version 1.0.0</span>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Modals (Add/Edit Test Case, Confirm Delete) -->
    <div class="modal fade" id="addEditTestCaseModal" tabindex="-1" aria-labelledby="addEditTestCaseModalLabel" aria-hidden="true">
        <!-- ... Modal Content ... -->
         <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEditTestCaseModalLabel">Add New Test Case</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="add-edit-testcase-form">
                        <input type="hidden" id="modal-mode">
                        <input type="hidden" id="modal-testcase-id">
                        <input type="hidden" id="modal-module-id">

                        <div class="mb-3" id="modal-phase-group" style="display:block;">
                            <label for="modal-test-phase" class="form-label">Test Phase <span class="text-danger">*</span></label>
                            <select id="modal-test-phase" class="form-select form-select-lg" required>
                                <option value="" selected disabled>-- กรุณาเลือก Phase --</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="modal-testcase-code" class="form-label">Test Case Code</label>
                            <input type="text" class="form-control" id="modal-testcase-code" required>
                            <div id="code-duplicate-error" class="invalid-feedback" style="display: none;">...</div>
                        </div>

                        <div class="mb-3">
                            <label for="modal-testcase-name" class="form-label">Test Case Name</label>
                            <input type="text" class="form-control" id="modal-testcase-name" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-update-testcase-btn">Save Test Case</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="deleteTcConfirmModal" tabindex="-1" aria-labelledby="deleteTcConfirmModalLabel" aria-hidden="true">
        <!-- ... Modal Content ... -->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteTcConfirmModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this test case (<strong id="delete-tc-code-display"></strong>)?
                    <br><strong class="text-danger">This action cannot be undone.</strong>
                    <div id="delete-scenario-warning" class="alert alert-warning mt-2" style="display: none;">
                        Cannot delete: This test case still has scenarios linked to it.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-tc-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ✅ [แก้ไข] Modal สำหรับ Add Scenario (ปรับปรุง Field) -->
    <div class="modal fade" id="scenarioModal" tabindex="-1" aria-labelledby="scenarioModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- 1. Header -->
                    <h5 class="modal-title" id="scenarioModalLabel">Add New Test Name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="scenario-form">
                        <input type="hidden" id="modal-tc-id-for-scenario"> <!-- เก็บ Test Case ID หลัก -->

                        <!-- 2. Test ID (Auto-generated Scenario ID) -->
                        <div class="mb-3">
                            <label for="scenario-id-code" class="form-label">Test ID</label>
                            <input type="text" class="form-control" id="scenario-id-code" readonly>
                        </div>

                        <!-- 3. Test Name (Scenario Name) -->
                        <div class="mb-3">
                            <label for="scenario-name" class="form-label">Test Name</label>
                            <input type="text" class="form-control" id="scenario-name" placeholder="ระบุชื่อ Test Name (Scenario)" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="scenario-name" class="form-label">Scenario Type</label>
                            <select id="scenario-type" class="form-select" required>
                                <option value="" disabled selected>-- เลือกประเภท --</option>
                                <option value="Happy Path">Happy Path</option>
                                <option value="Unhappy Path">Unhappy Path</option>
                                <option value="Error Case">Error Case</option>
                                <option value="Alternative Path">Alternative Path</option>
                            </select>
                        </div>

                        <!-- 4. Remark (Test Case Function) -->
                        <div class="mb-3">
                            <label for="scenario-remark" class="form-label">Remark</label>
                            <input type="text" class="form-control" id="scenario-remark" placeholder="ระบุหมายเหตุเพิ่มเติม (ถ้ามี)">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-scenario-btn">Save Test Name</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ✅ SCRIPT LINKS (Correct Order) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 1. Supabase JS Library (Loaded First) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- 2. Supabase Client Initializer -->
    <script src="/js/supabase-client.js"></script>

    <!-- 3. Layout Loader Tool -->
    <script src="/js/layout-loader.js"></script>

    <!-- 4. Main Layout Script (Assuming your file is index.js based on error) -->
    <script src="/js/index.js"></script>

    <!-- 5. Page Specific Script (None for index.html) -->
    <script src="/js/prototype_test.js"></script>
</body>
</html>
