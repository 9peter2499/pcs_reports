<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Test Phases - PCS Test Case</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">

    <style>
        /* (Req 2) กำหนดความกว้างและความสูงสูงสุดให้คอลัมน์ Detail */
        .detail-column-content {
            max-width: 400px; /* กำหนดความกว้างสูงสุด */
            max-height: 100px; /* กำหนดความสูงสูงสุด */
            overflow-y: auto; /* เพิ่ม Scrollbar แนวตั้งถ้าเนื้อหาเกิน */
            white-space: normal; /* อนุญาตให้ตัดคำขึ้นบรรทัดใหม่ */
            word-break: break-word; /* ตัดคำยาวๆ */
            border: 1px solid #eee; /* เพิ่มกรอบบางๆ */
            padding: 5px;
            background-color: #f8f9fa; /* สีพื้นหลังอ่อนๆ */
        }
        /* Style สำหรับ Quill Editor ใน Modal */
        #detail-editor-container .ql-container.ql-snow {
             min-height: 150px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header id="header-placeholder" class="app-header fixed-top"></header>
        <nav id="sidebar-placeholder" class="bg-white sidebar-hidden"></nav>

        <main id="main-content" class="main-content-expanded">
            <div class="container-fluid pt-4 px-4 content-wrapper">

                <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '>';">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index.html">Dashboard</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Configure Test Phases</li>
                    </ol>
                </nav>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 id="page-title">จัดการประเภทการทดสอบ (Test Phases)</h4>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body">
                        <div class="row g-3 justify-content-between align-items-center">
        
                            <div class="col-md-5"> 
                                <select id="phase-code-filter" class="form-select form-select-lg">
                                    <option value="all" selected>All Phase Codes</option>
                                </select>
                            </div>

                            <div class="col-md-5"> 
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" id="search-phase-input" class="form-control" placeholder="ค้นหา Name หรือ Detail..."> 
                                </div>
                            </div>

                            <div class="col-md-auto">
                                <button type="button" class="btn btn-primary" id="add-phase-btn">
                                    <i class="bi bi-plus-circle me-1"></i> Add New Phase
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <div id="loading-indicator" class="text-center p-5" style="display: none;">...Loading...</div>
                        <div id="error-message" class="alert alert-danger" style="display: none;"></div>

                        <div class="table-responsive">
                            <table class="table table-bordered table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 5%;" class="text-center">No.</th>
                                        <th style="width: 15%;" class="text-center">Phase Code</th>
                                        <th style="width: 20%;" class="text-center">Name</th>
                                        <th style="width: 40%;" class="text-center">Detail</th>
                                        <th style="width: 15%;" class="text-center">Created Date</th>  
                                        <th style="width: 5%;" class="text-center"></th>              
                                    </tr>
                                </thead>
                                <tbody id="phases-tbody">
                                    <tr>
                                        <td colspan="6" class="text-center p-5">Loading data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div> 
        </main>
    </div> 

    <div class="modal fade" id="phaseModal" tabindex="-1" aria-labelledby="phaseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg"> 
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="phaseModalLabel">Add New Test Phase</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="phase-form">
                        <input type="hidden" id="modal-phase-id">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="phase-type" class="form-label">Phase Type</label>
                                <select id="phase-type" class="form-select form-select-lg">
                                    <option value="UNIT" selected>Unit Test</option>
                                    <option value="SIT" selected>System Integration Test</option>
                                    <option value="UAT" selected>User Acceptance Test</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="modal-phase-code" class="form-label">Phase Code <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="modal-phase-code" required>
                                <div class="invalid-feedback" id="code-duplicate-error" style="display: none;">
                                    This Phase Code already exists.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="modal-display-order" class="form-label">Display Order (Optional)</label>
                                <input type="number" class="form-control" id="modal-display-order">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="modal-phase-name" class="form-label">Phase Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="modal-phase-name" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="detail-editor" class="form-label">Detail</label>
                            <div id="detail-toolbar-container"></div>
                            <div id="detail-editor-container">
                                <div id="detail-editor" style="min-height: 150px;"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-phase-btn">Save Phase</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deletePhaseModal" tabindex="-1" aria-labelledby="deletePhaseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deletePhaseModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete the phase "<strong id="delete-phase-name"></strong>"?
                    <br><small class="text-warning">Test cases using this phase will have their phase set to null.</small>
                    <input type="hidden" id="delete-phase-id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-phase-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.js"></script>

    <script src="/js/supabase-client.js"></script>
    <script src="/js/layout-loader.js"></script>
    <script src="/js/index.js"></script> <script src="/js/tcpcfg.js"></script> 
</body>
</html>